<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <style>
      /* Bootstrap CSS supplement */
      .table-responsive th {
        white-space: nowrap;
      }
      /* my css */
      .same-line-left {
        text-align: left;
      }
      .same-line-right {
        text-align: right;
        float: right;
      }
      .center {
        text-align: center;
      }
      .display-block {
        display: block;
      }
    </style>

    <!-- Google Material icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <title>kakeibo7</title>
  </head>
  <body>
    <header>
      <nav
        class="
          navbar navbar-expand-sm navbar-toggleable-sm navbar-light
          bg-white
          border-bottom
          box-shadow
          mb-3
        "
      >
        <div class="container">
          <a class="navbar-brand" href="#">kakeibo7</a>
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target=".navbar-collapse"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div
            class="
              navbar-collapse
              collapse
              d-sm-inline-flex
              flex-sm-row-reverse
            "
          >
            <ul class="navbar-nav flex-grow-1">
              <li class="nav-item">
                <a class="nav-link text-dark" href="#">リスト</a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-dark" href="#">精算</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <div class="container">
      <main role="main" class="pb-3">
        <h2 class="center">2021年9月</h2>

        <div>
          <a class="btn btn-outline-secondary same-line-left" href="#" role="button">前月</a>
          <a class="btn btn-outline-secondary same-line-right" href="#" role="button">翌月</a>
        </div>
        <br />

        <div>
          <a class="btn btn-outline-primary" href="#" role="button">精算</a>
        </div>
        <br />

        <div>
          <a class="btn btn-outline-success display-block" href="#" role="button">追加</a>
        </div>
        <br />

        <div id="table-place" class="table-responsive">
          <table id="table" class="table table-sm table-striped">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">修正</th>
                <th scope="col">削除</th>
                <th scope="col">支払日</th>
                <th scope="col">購入物名</th>
                <th scope="col">支出額</th>
                <th scope="col">ユーザー名</th>
                <!-- <th scope="col">支払方法名</th> -->
                <th scope="col">支出分類名</th>
                <th scope="col">期間開始日</th>
                <th scope="col">期間終了日</th>
                <th scope="col">○月分</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">1</th>
                <td><span class="material-icons">edit</span></td>
                <td><span class="material-icons">delete</span></td>
                <td>支払日</td>
                <td>購入物名</td>
                <td>支出額</td>
                <td>ユーザー名</td>
                <!-- <td>支払方法名</td> -->
                <td>支出分類名</td>
                <td>期間開始日</td>
                <td>期間終了日</td>
                <td>○月分</td>
              </tr>
              <tr>
                <th scope="row">2</th>
                <td><span class="material-icons">edit</span></td>
                <td><span class="material-icons">delete</span></td>
                <td>支払日</td>
                <td>購入物名</td>
                <td>支出額</td>
                <td>ユーザー名</td>
                <!-- <td>支払方法名</td> -->
                <td>支出分類名</td>
                <td>期間開始日</td>
                <td>期間終了日</td>
                <td>○月分</td>
              </tr>
              <tr>
                <th scope="row">3</th>
                <td><span class="material-icons">edit</span></td>
                <td><span class="material-icons">delete</span></td>
                <td>支払日</td>
                <td>購入物名</td>
                <td>支出額</td>
                <td>ユーザー名</td>
                <!-- <td>支払方法名</td> -->
                <td>支出分類名</td>
                <td>期間開始日</td>
                <td>期間終了日</td>
                <td>○月分</td>
              </tr>
            </tbody>
          </table>
        </div>
      </main>
    </div>

    <footer class="border-top footer text-muted">
      <div class="container">&copy; 2021 - kakeibo7</div>
    </footer>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <!-- My JavaScript -->
    <script>
      (async() => {
        await fetch("http://localhost:4010/kakeibo/2021/09")
        .then(response => response.json())
        .then((data) => {
          const newTable = document.createElement("table");
          const newTableBody = newTable.createTBody()

          if (Array.isArray(data.expenses)) {
            data.expenses.forEach((expense) => {
              const newRow = newTableBody.insertRow();
              
              const newIDCell = newRow.insertCell();
              const id = document.createTextNode(expense.row_id);
              newIDCell.appendChild(id);

              const newEditIconCell = newRow.insertCell();
              const newEditIconSpan = document.createElement("span");
              newEditIconSpan.classList.add("material-icons");
              const editStr = document.createTextNode("edit");
              newEditIconSpan.appendChild(editStr)
              newEditIconCell.appendChild(newEditIconSpan);

              const newDeleteIconCell = newRow.insertCell();
              const newDeleteIconSpan = document.createElement("span");
              newDeleteIconSpan.classList.add("material-icons");
              const deleteStr = document.createTextNode("delete");
              newDeleteIconSpan.appendChild(deleteStr)
              newDeleteIconCell.appendChild(newDeleteIconSpan);

              const newPayDateCell = newRow.insertCell();
              const payDate = document.createTextNode(expense.pay_date);
              newPayDateCell.appendChild(payDate);

              const newPayItemCell = newRow.insertCell();
              const payItem = document.createTextNode(expense.pay_item);
              newPayItemCell.appendChild(payItem);

              const newPriceCell = newRow.insertCell();
              const price = document.createTextNode(expense.price);
              newPriceCell.appendChild(price);

              const newPayUserCell = newRow.insertCell();
              const payUser = document.createTextNode(expense.pay_user.name);
              newPayUserCell.appendChild(payUser);

              // 支払い方法？
              // const newIDCell = newRow.insertCell();
              // const id = document.createTextNode(expense.row_id);
              // newIDCell.appendChild(id);

              const newCostTypeCell = newRow.insertCell();
              const costType = document.createTextNode(expense.cost_type.name);
              newCostTypeCell.appendChild(costType);

              const newStartDateCell = newRow.insertCell();
              const startDate = document.createTextNode(expense.start_date);
              newStartDateCell.appendChild(startDate);

              const newEndDateCell = newRow.insertCell();
              const endDate = document.createTextNode(expense.end_date);
              newEndDateCell.appendChild(endDate);

              const newTargetMonthCell = newRow.insertCell();
              const targetMonth = document.createTextNode(expense.target_month);
              newTargetMonthCell.appendChild(targetMonth);
            })
          }

          newTable.classList.add("table");
          newTable.classList.add("table-sm");
          newTable.classList.add("table-striped");

          const tableElement = document.getElementById("table")
          newTable.tHead = tableElement.tHead;

          const tablePlaceElement = document.getElementById("table-place")
          tablePlaceElement.replaceChild(newTable, tableElement);
        })
        .catch(err => console.log(err))
      })();
    </script>
  </body>
</html>
